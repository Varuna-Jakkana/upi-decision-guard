{% extends "base.html" %}
{% block content %}
<style>
  /* Theme-aware label colors */
  body[data-theme="dark"] .setup-label,
  body[data-theme="dark"] .setup-heading {
    color: #e5e7eb !important;
  }

  body[data-theme="light"] .setup-label,
  body[data-theme="light"] .setup-heading {
    color: #1f2937 !important;
  }

  .category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
</style>

<div class="glass-card fade-in-up" style="max-width: 700px; margin: 0 auto;">
  <h2 class="setup-heading">ğŸ¦ Setup Your Monthly Budget</h2>
  {% if error %}
  <div
    style="background: #fee2e2; color: #dc2626; padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid #ef4444;">
    <strong>ğŸš« {{ error }}</strong>
  </div>
  {% endif %}

  <form method="POST" onsubmit="return checkBudget();">
    <label class="setup-label" style="display: block; margin-bottom: 1.5rem; font-weight: 500;">
      Total Monthly Budget (â‚¹):
      <input type="number" id="budget" name="budget" value="{{ request.form.budget or '10000' }}" required
        style="width: 100%; max-width: 300px; margin-top: 0.5rem; padding: 0.5rem;">
    </label>

    <h3 class="setup-heading" style="margin-top: 1.5rem; margin-bottom: 1rem; font-size: 1.2rem;">Category Limits</h3>

    <div class="category-grid">
      <label class="setup-label" style="font-weight: 500;">
        ğŸ” Food (â‚¹):
        <input type="number" id="food" name="food_limit" value="{{ request.form.food_limit or '2000' }}" required
          style="width: 100%; margin-top: 0.5rem; padding: 0.5rem;">
      </label>

      <label class="setup-label" style="font-weight: 500;">
        ğŸ›’ Shopping (â‚¹):
        <input type="number" id="shopping" name="shopping_limit" value="{{ request.form.shopping_limit or '2000' }}"
          required style="width: 100%; margin-top: 0.5rem; padding: 0.5rem;">
      </label>

      <label class="setup-label" style="font-weight: 500;">
        ğŸ¬ Entertainment (â‚¹):
        <input type="number" id="ent" name="entertainment_limit"
          value="{{ request.form.entertainment_limit or '1000' }}" required
          style="width: 100%; margin-top: 0.5rem; padding: 0.5rem;">
      </label>

      <label class="setup-label" style="font-weight: 500;">
        ğŸ’¡ Bills & Utilities (â‚¹):
        <input type="number" id="bills" name="bills_limit" value="{{ request.form.bills_limit or '1500' }}" required
          style="width: 100%; margin-top: 0.5rem; padding: 0.5rem;">
      </label>

      <label class="setup-label" style="font-weight: 500;">
        âš•ï¸ Health & Medical (â‚¹):
        <input type="number" id="health" name="health_limit" value="{{ request.form.health_limit or '1000' }}" required
          style="width: 100%; margin-top: 0.5rem; padding: 0.5rem;">
      </label>

      <label class="setup-label" style="font-weight: 500;">
        ğŸ’° Savings (â‚¹):
        <input type="number" id="savings" name="savings_limit" value="{{ request.form.savings_limit or '2000' }}"
          required style="width: 100%; margin-top: 0.5rem; padding: 0.5rem;">
      </label>

      <label class="setup-label" style="font-weight: 500;">
        ğŸ“¦ Others (â‚¹):
        <input type="number" id="others" name="others_limit" value="{{ request.form.others_limit or '500' }}" required
          style="width: 100%; margin-top: 0.5rem; padding: 0.5rem;">
      </label>
    </div>

    <button type="submit" class="btn"
      style="background: linear-gradient(135deg, #10b981, #059669); color: white; margin-top: 1rem; padding: 0.75rem 1.5rem;">Save
      & Continue</button>
  </form>
</div>

<script>
  function checkBudget() {
    var budget = parseFloat(document.getElementById('budget').value) || 0;
    var food = parseFloat(document.getElementById('food').value) || 0;
    var shopping = parseFloat(document.getElementById('shopping').value) || 0;
    var ent = parseFloat(document.getElementById('ent').value) || 0;
    var bills = parseFloat(document.getElementById('bills').value) || 0;
    var health = parseFloat(document.getElementById('health').value) || 0;
    var savings = parseFloat(document.getElementById('savings').value) || 0;
    var others = parseFloat(document.getElementById('others').value) || 0;

    var sum = food + shopping + ent + bills + health + savings + others;

    if (Math.abs(sum - budget) > 0.01) {
      alert('ğŸš« BUDGET MISMATCH!\n\nSum of categories = â‚¹' + sum.toFixed(0) + '\nTotal Budget = â‚¹' + budget.toFixed(0) + '\n\nMake them EXACTLY equal!');
      return false;
    }
    return true;
  }
</script>
{% endblock %}